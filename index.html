<!DOCTYPE html>
<html>
    <head>
        <title>Displaying Base64 Images</title>
        <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
        <style>
            #map {
                height: 600px;
                width: 100%;
            }
        </style>
    </head>

    <body>
        <h1>Base64 Images</h1>
        <form method="GET" action="/get-data">
            <label for="name">Name:</label>
            <input type="text" id="name" name="name" required>
            <br><br>
            <label for="user_id">User ID:</label>
            <input type="number" id="user_id" name="user_id" required>
            <br><br>
            <button type="submit">Submit</button>
        </form>

        <div id="map"></div>
        <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

        <div id="images"></div>

        <script>
            const form = document.querySelector("form");
            form.addEventListener("submit", async (event) => {
                event.preventDefault();

                const imageContainer = document.getElementById("images");

                imageContainer.innerHTML = ''

                const name = document.getElementById("name").value;
                const userId = document.getElementById("user_id").value;

                connection_str = "http://127.0.0.1:8000/task/"+ name + "/" + userId;
                const response = await fetch(connection_str);
                const imageData = await response.json();    

                var locations = []
                imageData.forEach(image=> {
                    const imgElement = document.createElement("img");
                    imgElement.src = `data:image/jpg;base64,${image.image}`;
                    imageContainer.appendChild(imgElement);
                    long = image.location.longitude
                    lat = image.location.latitude
                    console.log(long)
                    console.log(lat)
                    locations.push({"latitude": lat, "longitude": long},)
                })

                
                var map = L.map('map').setView([51.505, -0.09], 13);

                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(map);

                function addMarkers(locations) {
                    for (var i = 0; i < locations.length; i++) {
                        var location = locations[i];
                        L.marker([location.latitude, location.longitude]).addTo(map);
                    }
                }

                addMarkers(locations);
                })
        </script>
    </body>
</html>